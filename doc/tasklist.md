# План разработки Smart DevSecOps/MLOps Assistant

## Прогресс выполнения

- **Итерация 1:** ⬜ Не начата
- **Итерация 2:** ⬜ Не начата  
- **Итерация 3:** ⬜ Не начата
- **Итерация 4:** ⬜ Не начата
- **Итерация 5:** ⬜ Не начата
- **Итерация 6:** ⬜ Не начата
- **Итерация 7:** ⬜ Не начата
- **Итерация 8:** ⬜ Не начата
- **Итерация 9:** ⬜ Не начата

---

## Итерация 1: Prerequisites (подготовка инфраструктуры)
- [ ] Развертывание LLM модели (GPT-OSS-20b/Gemma 3 270M) через KServe  
- [ ] Проверка доступности KServe endpoint'а
- [ ] Настройка OpenSearch индексов (пустые, но готовые)
- [ ] Настройка Redis для CAG кэша
- [ ] **Тест:** Ping KServe endpoint'а, получение статуса модели

---

## Итерация 2: Базовый FastAPI Backend
- [ ] Создание структуры проекта согласно @vision.md
- [ ] Настройка FastAPI приложения (@main.py, @config.py)
- [ ] Реализация OpenAI-совместимого endpoint (/v1/chat/completions)
- [ ] Pydantic модели для запросов/ответов (@schemas/chat_models.py)
- [ ] Базовое логирование и обработка ошибок
- [ ] **Тест:** Отправка POST запроса, получение echo-ответа

---

## Итерация 3: Интеграция с KServe (LLM)  
- [ ] Реализация клиента KServe (@llm/kserve_client.py)
- [ ] OpenAI адаптер для преобразования форматов (@llm/openai_adapter.py)
- [ ] Обработчик чат-запросов (@core/chat_handler.py)
- [ ] Настройка конфигурации для KServe endpoint
- [ ] **Тест:** Отправка запроса через FastAPI → KServe → LLM, получение ответа

---

## Итерация 4: CAG система (Cache Augmented Generation)
- [ ] Интеграция с Redis (@cag/cache.py)
- [ ] Загрузчик статических данных (@data/loader.py)
- [ ] Парсинг markdown документации в кэш
- [ ] Логика поиска в кэше CAG
- [ ] **Тест:** Запрос документации через чат, получение кэшированного ответа

---

## Итерация 5: RAG система (Retrieval Augmented Generation)
- [ ] Интеграция с OpenSearch (@rag/search.py) 
- [ ] Генерация embeddings с sentence-transformers
- [ ] Векторный и текстовый поиск в OpenSearch
- [ ] Объединение RAG и CAG в chat_handler
- [ ] **Тест:** Запрос метрик/логов через чат, получение обогащённого ответа

---

## Итерация 6: Open WebUI интеграция
- [ ] Настройка Open WebUI для подключения к FastAPI
- [ ] Конфигурация CORS и middleware (@api/middleware.py)
- [ ] WebSocket поддержка для стриминга ответов
- [ ] Тестирование полного UI workflow
- [ ] **Тест:** Полноценный чат через веб-интерфейс Open WebUI

---

## Итерация 7: Мониторинг и логирование
- [ ] Структурированное логирование в JSON формат
- [ ] Интеграция с OpenSearch Stack для централизованных логов
- [ ] Prometheus метрики для FastAPI и компонентов
- [ ] Корреляция ID для трекинга запросов
- [ ] **Тест:** Проверка метрик в Grafana, поиск логов в OpenSearch Dashboards

---

## Итерация 8: CI/CD Pipeline для RAG/CAG данных
- [ ] Airflow DAGs для обновления RAG данных (@dags/rag_pipeline.py)
- [ ] Pipeline для CAG документации (@dags/cag_pipeline.py)  
- [ ] Процессоры данных (@dags/data_processors/)
- [ ] MLFlow интеграция для трекинга качества pipeline
- [ ] **Тест:** Автоматическое обновление данных, проверка качества через MLFlow

---

## Итерация 9: Выполнение команд (2 варианта на выбор)

### Вариант A: N8N Workflow Automation
- [ ] Интеграция FastAPI с N8N webhooks (@core/workflow_client.py)
- [ ] Создание базовых N8N workflow'ов (kubectl, Prometheus запросы)
- [ ] Система подтверждений через N8N conditional logic
- [ ] Настройка аудита и уведомлений в N8N
- [ ] **Тест:** Выполнение kubectl get pods через N8N workflow из чата

### Вариант B: Action Agent (классический подход)
- [ ] Базовый агент для kubectl команд (@core/agent.py)
- [ ] Интеграция с Prometheus API для метрик
- [ ] Система подтверждений и dry-run режим
- [ ] RBAC проверки для безопасности действий  
- [ ] **Тест:** Выполнение kubectl get pods через чат-команду

**Выбор варианта:** Решаем на этапе реализации

---

## Критерии готовности проекта

### Функциональные требования
- [ ] Ответы на вопросы через RAG (метрики, логи)
- [ ] Быстрый доступ к документации через CAG
- [ ] Выполнение DevOps команд (N8N workflow'ы или Action Agent)
- [ ] Работающий веб-интерфейс Open WebUI

### Нефункциональные требования  
- [ ] Время ответа < 3 сек для обычных запросов
- [ ] Поиск в векторной базе < 200ms
- [ ] Кэш CAG отвечает < 50ms
- [ ] Логирование всех действий и ошибок

### Производственная готовность
- [ ] Kubernetes деплойменты готовы
- [ ] Мониторинг и алерты настроены  
- [ ] Документация обновлена (@vision.md, @logic-file.md)
- [ ] CI/CD pipeline стабильно работает